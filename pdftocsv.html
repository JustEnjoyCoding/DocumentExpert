<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF to CSV Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css" rel="stylesheet" />
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>
    <style>
      .gradient-bg {
        background: linear-gradient(120deg, #4f46e5 0%, #10b981 100%);
      }
      .drop-zone {
        border: 2px dashed #cbd5e1;
        transition: all 0.3s ease;
      }
      .drop-zone.dragover {
        border-color: #4f46e5;
        background-color: rgba(79, 70, 229, 0.05);
      }
      .preview-table {
        max-height: 400px;
        overflow-y: auto;
      }
      .spinner {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 fixed w-full z-20 top-0">
      <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
        <a href="#" class="flex items-center space-x-3">
          <img style="height: 60px;" src="./images/LOGOP.png" alt="Logo">
        </a>
        <!-- Navigation items -->
      </div>
    </nav>

    <div class="min-h-screen bg-gray-50 pt-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center">
          <h1 class="text-4xl font-bold text-gray-900 mb-4">PDF to CSV Converter</h1>
          <p class="text-lg text-gray-600 mb-8">
            Transform PDF tables into editable CSV files with automatic formatting and preview.
          </p>
          
          <!-- AdSense Block 1 -->
          <div class="mb-8 w-full">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
            crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                data-ad-slot="XXXXXXXXXX"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
          <div id="dropZone" class="drop-zone rounded-lg p-12 text-center cursor-pointer mb-6"
            ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
            <div class="space-y-4">
              <div class="flex justify-center">
                <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
              </div>
              <p class="text-gray-600">Drag and drop PDF files here</p>
              <p class="text-gray-400 text-sm">or</p>
              <label for="pdfFile" 
                class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white gradient-bg hover:opacity-90 transition-opacity cursor-pointer">
                Browse Files
              </label>
              <input type="file" id="pdfFile" accept="application/pdf" class="hidden" />
            </div>
          </div>

          <div id="processing" class="hidden items-center justify-center space-x-2 mb-6">
            <div class="spinner h-8 w-8 border-4 border-gray-300 border-t-blue-600 rounded-full"></div>
            <span class="text-gray-600">Processing PDF...</span>
          </div>

          <div id="error" class="hidden p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert"></div>

          <div id="preview" class="hidden">
            <div class="mb-4">
              <h3 class="text-lg font-medium text-gray-900 mb-2">CSV Preview</h3>
              <div class="preview-table border rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200" id="previewTable"></table>
              </div>
            </div>
            <button onclick="downloadCSV()"
              class="gradient-bg text-white px-6 py-3 rounded-md hover:opacity-90 transition-opacity w-full sm:w-auto">
              Download CSV File
            </button>
          </div>
        </div>

        <!-- AdSense Block 2 -->
        <div class="mb-8 w-full">
          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
          crossorigin="anonymous"></script>
          <ins class="adsbygoogle"
              style="display:block"
              data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
              data-ad-slot="XXXXXXXXXX"
              data-ad-format="auto"
              data-full-width-responsive="true"></ins>
          <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>

        <div class="grid md:grid-cols-3 gap-8 text-gray-600">
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-semibold mb-2">Batch Processing</h3>
            <p>Convert multiple PDF files simultaneously with bulk conversion support.</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-semibold mb-2">Table Detection</h3>
            <p>Automatic table recognition with manual adjustment capabilities.</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-semibold mb-2">Format Options</h3>
            <p>Customize delimiter type and encoding format for your CSV files.</p>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.0/xlsx.full.min.js"></script>

    <script>
      let csvData = null;

      // Drag and drop handlers
      function handleDragOver(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.add('dragover');
      }

      function handleDragLeave(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.remove('dragover');
      }

      function handleDrop(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files[0]?.type === 'application/pdf') {
          handleFile(files[0]);
        }
      }

      document.getElementById('pdfFile').addEventListener('change', function(e) {
        handleFile(e.target.files[0]);
      });

      async function handleFile(file) {
        try {
          document.getElementById('error').classList.add('hidden');
          document.getElementById('processing').classList.remove('hidden');
          
          const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
          let csvContent = '';

          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const text = textContent.items.map(item => item.str).join(' ');
            
            const rows = text.split('\n').filter(row => row.trim());
            const csvRows = rows.map(row => {
              const columns = row.split(/(\s{2,}|\t)/).filter(c => c.trim());
              return columns.join(',');
            });
            
            csvContent += csvRows.join('\n') + '\n';
          }

          csvData = csvContent;
          showPreview(csvContent);
          document.getElementById('processing').classList.add('hidden');
        } catch (error) {
          showError('Error processing PDF: ' + error.message);
          document.getElementById('processing').classList.add('hidden');
        }
      }

      function showPreview(csv) {
        const previewTable = document.getElementById('previewTable');
        previewTable.innerHTML = '';
        const rows = csv.split('\n');

        rows.slice(0, 10).forEach((row, i) => {
          const tr = document.createElement('tr');
          tr.className = i % 2 === 0 ? 'bg-white' : 'bg-gray-50';
          
          row.split(',').forEach(cell => {
            const td = document.createElement('td');
            td.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-700';
            td.textContent = cell;
            tr.appendChild(td);
          });
          
          previewTable.appendChild(tr);
        });

        document.getElementById('preview').classList.remove('hidden');
      }

      function downloadCSV() {
        if (!csvData) return;
        
        const blob = new Blob([csvData], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `converted-${Date.now()}.csv`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
      }

      function showError(message) {
        const errorDiv = document.getElementById('error');
        errorDiv.textContent = message;
        errorDiv.classList.remove('hidden');
      }
    </script>
  </body>
</html>